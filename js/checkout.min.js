!function(a){"use strict";function b(){l=a(document.body),d(),c(),l.ready(i)}function c(){a(window).on("currency_switched",function(){recalculate_taxes(),j()})}function d(){l.on("edd_quantity_updated",f),l.on("change",".yst-edd-pricing-switcher",g),l.on("edd_cart_billing_address_updated",h),a("#billing_country").on("change",function(){k(),j()}),a(document).ajaxComplete(e),a("#edd_first").focus()}function e(a,b,c){if(c.url===edd_global_vars.ajaxurl&&"undefined"!=typeof b.responseJSON){var d=b.responseJSON;d&&"valid"==d.msg&&"0.00"==d.total_plain&&location.reload()}}function f(a,b){EDD_Checkout.recalculate_taxes()}function g(b){var c=a(b.currentTarget),d=c.data("download-id"),e=c.val(),f={action:"yst_update_variation",download_id:d,price_id:e};a.ajax({type:"POST",data:f,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0}}).success(function(a){"success"===a.status&&EDD_Checkout.recalculate_taxes()})}function h(b,c){"nostates"===c?a("#edd-card-state-wrap").hide():a("#edd-card-state-wrap").show()}function i(){a("#edd-discount").attr("autocomplete","off")}function j(){var b=a("#billing_country").val(),c=a(".yst_currency_switch_dropdown").val(),d=a("#yst-payment-methods-list");return""===b?void d.text(YoastI18n.select_country):""===c?void d.text(YoastI18n.select_currency):void a.ajax({type:"POST",data:{country_code:b,currency:c},dataType:"json",url:YoastAjax.admin+"?action=yst_update_payment_methods",beforeSend:function(){d.text(YoastI18n.loading+"...")}}).success(function(a){"success"===a.status&&d.html(a.html)})}function k(){var b=a("#billing_country").val();a.ajax({type:"POST",data:{billing_country:b},dataType:"json",url:YoastAjax.admin+"?action=yst_update_supported_currencies",beforeSend:function(){a(".yst_currency_switch").text(YoastI18n.loading+"...")}}).success(function(b){a(".yst_currency_switch").replaceWith(b.html),a("ul.yoast-main-menu li.controls").find("select.yst_currency_switch_dropdown").replaceWith(b.menu_html)})}var l;a(b)}(jQuery),function(a){function b(){e=parseInt(a("#steps-progress").data("step"),10),a("#yst-to-step-3").on("click",c.bind(window,3)),a("#yst-to-step-4").on("click",c.bind(window,4))}function c(a,b){a>e&&(d(),b.preventDefault())}function d(){switch(e){case 2:a("#edd_next_button").click();break;case 3:a("#edd-purchase-button").click()}}var e;a(b)}(jQuery),function(a){function b(c,d){if(""!==c&&""!==d){var e=a("#yst-edd-btw-wrap .fa-spinner");e.addClass("show"),m.start(),k.country=c,k.number=d,k.valid=null;var f=jQuery.post(yoast_com_checkout_vars.ajaxurl,{action:"yst_check_vat",country:c,vat_nr:d},function(b){e.removeClass("show"),a("#vaterror").remove(),"1"==b?(a("#yst_btw").removeClass("error").addClass("valid"),k.valid=!0,m.success()):"2"==b?(a("#yst_btw").removeClass("valid").addClass("error"),jQuery("#yst-edd-btw-wrap").append('<span id="vaterror" class="error">We cannot check if your VAT number is correct because the VAT checking system for the EU is currently down. We\'re sorry for the inconvenience. Please send us an email on <a href="mailto:support@yoast.com">support@yoast.com</a> or try again later.</span>'),k.valid=!1,m.failed()):(a("#yst_btw").removeClass("valid").addClass("error"),jQuery("#yst-edd-btw-wrap").append('<span id="vaterror" class="error">We cannot verify this VAT number, this means you will have to pay VAT. Please make sure you\'ve entered the number correctly.</span>'),k.valid=!1,m.notVerified())});f.fail(function(){setTimeout(b,1e3)})}}function c(a){return Math.round(100*a)/100}function d(){return 1==k.valid&&"NL"!==k.country&&0!==taxData.tax_rate_raw}function e(b,e){var f=e.response;"undefined"!=typeof f.billing_country&&""!==f.billing_country&&g(f.billing_country),d()&&(f.total_raw=f.total_raw-parseFloat(f.tax_raw),f.tax_raw=0,f.tax_rate_raw=0,f.tax_rate="0%",f.total="$ "+c(f.total_raw),f.tax="$"+c(f.tax_raw),a(".edd_cart_amount").html(f.total),a(".yst-tax-rate").html(f.tax_rate.replace("%","")),a(".edd_cart_tax_amount").html(f.tax));var h=a("#yst_secondary_tax_rate");h.length>0&&h.html(f.tax_rate.replace("%","")),a("#yst_secondary_tax").html(f.tax)}function f(){var b=a("#billing_country"),c=b.val();""===c?a("#edd-card-state-wrap").hide():b.trigger("change")}function g(b){a.ajax({url:YoastAjax.admin+"?action=yst_display_vat_input",data:{billing_country:b},dataType:"json",type:"post",success:function(b){b.display_vat===!0?a("#yst-edd-btw-wrap").show():a("#yst-edd-btw-wrap").hide()}})}function h(b){var c=a("#billing_country").val(),d=a("#yst-edd-btw-wrap");return a("#yst-dutch-vat-notice").remove(),"NL"===c&&d.after('<p id="yst-dutch-vat-notice"><strong>Please note:</strong> Since Yoast is based in the Netherlands we cannot reverse charge the VAT.<br />VAT will be added to the invoice.</p>'),b&&0===b.tax_rate_raw?(d.hide(),void a(".edd_cart_tax_row").css("display","none")):(a(".edd_cart_tax_row").css("display","table-row"),void d.show())}function i(){a(".chosen-select").chosen(),j.on("edd_cart_billing_address_updated",function(){a("#edd-card-state-wrap .chosen-container").remove(),a('select[name="card_state"]').chosen()})}var j,k={valid:!1,number:"",country:""},l=function(){this.startTime=0,this.endTime=0,this.duration=0,"undefined"!=typeof __gaTracker?this.tracker=__gaTracker:this.tracker=function(){}};l.prototype.start=function(){this.startTime=(new Date).getTime(),this.endTime=0,this.duration=0,this.tracker("send","event","checkout","vat-check","start")},l.prototype.end=function(){this.endTime=(new Date).getTime(),this.duration=this.endTime-this.startTime},l.prototype.notVerified=function(){this.end(),this.tracker("send","event","checkout","vat-check","cannot verify",this.duration)},l.prototype.failed=function(){this.end(),this.tracker("send","event","checkout","vat-check","failed",this.duration)},l.prototype.success=function(){this.end(),this.tracker("send","event","checkout","vat-check","ok",this.duration)};var m=new l;jQuery(document).ready(function(a){j=a("body"),f(),h(),i(),j.on("edd_taxes_recalculated",e),a("#card_number").payment("formatCardNumber"),a("#card-cvc").payment("formatCardCVC"),a("#card_number").on("input",function(){a.payment.validateCardNumber(a(this).val())?a(this).removeClass("error").addClass("valid"):a(this).removeClass("valid").addClass("error"),""!=a("#card_cvc").val()&&(a.payment.validateCardCVC(a("#card_cvc").val(),a.payment.cardType(a(this).val()))?a("#card_cvc").removeClass("error").addClass("valid"):a("#card_cvc").removeClass("valid").addClass("error"))}),a("#card_cvc").on("input",function(){a.payment.validateCardCVC(a(this).val(),a.payment.cardType(a("#card_number").val()))?a(this).removeClass("error").addClass("valid"):a(this).removeClass("valid").addClass("error")}),a("#card_exp_year").on("input",function(){var b=a("#card_exp_month").val(),c=a(this).val();return 4===c.length?(c=c.slice(-2),void a(this).val(c)):void(""!=b&&(a.payment.validateCardExpiry(b,c)?a("edd-input-cvc").removeClass("error").addClass("valid"):a("edd-input-cvc").removeClass("valid").addClass("error")))}),a("#edd_purchase_form").validate({unhighlight:function(b,c,d,e){"radio"===b.type?this.findByName(b.name).removeClass(c).addClass(d):a(b).hasClass("ignore")?a(b).removeClass(c).removeClass(d):a(b).removeClass(c).addClass(d)},errorClass:"error error-message",rules:{edd_email:{required:!0,email:!0},edd_first:"required",card_name:"required",card_address:{required:!0,minlength:2},card_city:{required:!0,minlength:2},card_zip:{required:!0,minlength:2},billing_country:"required",card_state:"required",edd_agree_to_terms:"required"},messages:{edd_first:"Please enter your first name",edd_email:"Please enter a valid email address",edd_agree_to_terms:"<strong>Error</strong> - Please accept our terms: ",card_name:"Please enter the name on your credit card",card_address:"Please enter your billing address",card_zip:"Please enter your zip / postal code",card_state:"Please enter your state",card_city:"Please enter your city",billing_country:"Please enter your country"}}),j.on("change","#yst_btw, #billing_country, #card_state",function(){var c=a("#yst_btw").val(),d=a("#billing_country").val();b(d,c),EDD_Checkout.recalculate_taxes()})})}(jQuery);
//# sourceMappingURL=checkout.min.js.map